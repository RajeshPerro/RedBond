<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org">
<head>
<title>RedBond | Found</title>

<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet"
	 integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" 
	 crossorigin="anonymous">
<link rel="stylesheet" type="text/css" th:href="@{/css/style.css}" />
<link rel="stylesheet" type="text/css" th:href="@{/css/searchstyle.css}" />
<link rel="stylesheet" type="text/css" th:href="@{/css/home.css}" />
<style type="text/css">
      html { height: 100% }
      body { height: 100%; margin: 0; padding: 0 }
      #map_canvas { height: 60% }
    </style>
    

<script>

    var map, infoWindow,i,obj,latt,lann,pos,marker;
    function initMap() {
      map = new google.maps.Map(document.getElementById('map_canvas'), {
        center: {lat: 51, lng: 19},
        zoom: 5
      });
      infoWindow = new google.maps.InfoWindow;
      
      // Try HTML5 geolocation.
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(function(position) {
      	
      	 
      	  
          pos = {
            lat: position.coords.latitude,
            lng: position.coords.longitude
          };
          /*  marker = new google.maps.Marker({
              position: pos,
              title: "Found"
          });
          marker.setMap(map); */
          /* infoWindow.setPosition(pos);
          infoWindow.setContent('Location found.');
          infoWindow.open(map); */
          map.setCenter(pos);
          
        }, function() {
          handleLocationError(true, infoWindow, map.getCenter());
        });
      } else {
        // Browser doesn't support Geolocation
        handleLocationError(false, infoWindow, map.getCenter());
      }
    }

    function handleLocationError(browserHasGeolocation, infoWindow, pos) {
      infoWindow.setPosition(pos);
      infoWindow.setContent(browserHasGeolocation ?
                            'Error: The Geolocation service failed.' :
                            'Error: Your browser doesn\'t support geolocation.');
      infoWindow.open(map);
        
      
      }
    function mapRajesh()
    {
    	initMap();
    	
    	$(document).ready(function() {
    		$("#a").click(function(){
    	  		alert("Request sent.!");
    	  		});
    		
    		
    	  	  var jsonData = $("#jsonData").val();
    	  	  var latLng; var i, lat, lan;
    	  	  
    	  	  console.log(jsonData);
    	  	  obj = JSON.parse(jsonData);
    	  	  var len = obj.length;
    	  	  
    	  	  
    	  	 
             
    	  	  var infowindow = new google.maps.InfoWindow();
    	  	  for(i=0; len; i++)
    			  {
    	  		  lat = obj[i].latitude;
    	  		  lan = obj[i].longitude;
    	  		var content = 	'<div class="infoWindow"><strong>' 	+obj[i].name + '</strong>'
    	  		+ '<br/>' 	+ obj[i].bloodgroup
    	  		+ '<br/>' 	+ obj[i].city
                + '<br/>' 	+ obj[i].email + '</div>'
                + '<br/>' 	+ obj[i].phone + '</div>';
                console.log(content);
    				 latLng = new google.maps.LatLng(lat,lan); 
    				 console.log("lat lng = "+latLng);
    			   var iconBase = 'https://maps.google.com/mapfiles/kml/shapes/';
    			   var marker = new google.maps.Marker({
    	            
    				position: latLng,
    	            title : obj[i].name,
    	            //icon: iconBase + 'schools_maps.png'
    	        });
    			   
    			   
    	        marker.setMap(map);
    	        
    	        google.maps.event.addListener(marker, 'mouseover', function() {
                    infowindow.setContent(content);
                    infowindow.open(map,marker);
                });
    	        
    	        
    		  } 
    	  		
    	    });
    }
    </script>
 </head>   
<body onload="mapRajesh()">

<nav class="navbar navbar-default navbar-fixed-top">
  <div class="container-fluid">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand title" href="/">RedBond</a>
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      
      
      <ul class="nav navbar-nav navbar-right">
        <li><a href="/admin/home">Home</a></li>
        <li><a href="#">Edit Profile</a></li>
        <li><a href="/admin/home">Search Again</a></li>
        <li><a href="/logout">Logout</a></li>
      </ul>
    </div><!-- /.navbar-collapse -->
  </div><!-- /.container-fluid -->
</nav>

<!-- <div>
	<span th:utext="${matchBlood}"></span>
</div> -->
<textarea style="display:none" rows="3" cols="500" th:utext="${matchBlood}" id="jsonData"> </textarea>
<div id="map_canvas"></div>
<div class="container" style="margin-top: 100px;">
<table class="table table-striped">
    <thead>
      <tr>
      	<th>#</th>
        <th>Name</th>
        <th>Email</th>
        <th>Phone</th>
        <th>Blood Group</th>
        <th>Address</th>
        <th>Request</th>
      </tr>
    </thead>
	  <tbody>
	  <tr th:each="matchBlood : ${matchBlood2}">
      <th scope="row">1</th>
      <td><span th:utext="${matchBlood.name}"></span></td>
      <td><span th:utext="${matchBlood.email}"></span></td>
      <td><span th:utext="${matchBlood.phone}"></span></td>
      <td><span th:utext="${matchBlood.bloodgroup}"></span></td>
      <td><span th:utext="${matchBlood.city}"></span></td>
      <td><button class="btn btn-warning" id="a">Save Life</button></td>
      </tr>
	  </tbody>
</table>
</div>

</body>
<footer class="container-fluid">
		<p> &copy; RedBond 2017 || All Rights Reserved</p>
</footer>

  
    <script async defer src="http://maps.googleapis.com/maps/api/js?key=AIzaSyDvhum3xU3dGLACk9ziBwFUGbwlsq7C_e8&callback=initMap">
    </script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script type="text/javascript" th:src="@{/js/custom.js}"></script>
</html>